<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>轮盘抽奖</title>
<style>
  #canvas { width: 400px; height: 400px; }
  button { margin-top: 10px; }
</style>
</head>
<body>
<h2>轮盘抽奖</h2>
<canvas id="canvas" width="400" height="400"></canvas>
<br/>
<button id="spinBtn">开始旋转</button>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let disks = [];
let currentRotation = 0;
let isSpinning = false;

// 加载配置
fetch('disks.json')
  .then(res => res.json())
  .then(data => {
    disks = data; // 轮盘项（数组）
    drawWheel();
  });

// 绘制轮盘
function drawWheel() {
  if (!disks || disks.length === 0) return;
  const total = disks.length;
  const anglePer = (2 * Math.PI) / total;
  
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.save();
  ctx.translate(canvas.width/2, canvas.height/2);
  ctx.rotate(currentRotation);
  
  for (let i=0; i<total; i++) {
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0, 0, 180, i*anglePer, (i+1)*anglePer);
    ctx.closePath();
    ctx.fillStyle = `hsl(${i*360/total},70%,50%)`;
    ctx.fill();

    // 文字
    ctx.save();
    ctx.rotate(i*anglePer + anglePer/2);
    ctx.translate(0, -100);
    ctx.rotate(Math.PI/2);
    ctx.fillStyle = 'white';
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(disks[i].option, 0, 0);
    ctx.restore();
  }

  ctx.restore();
}

// 旋转
function spin() {
  if (isSpinning || disks.length===0) return;
  isSpinning = true;

  // 随机抽取一个位置
  const selectedIndex = Math.floor(Math.random() * disks.length);
  const total = disks.length;
  const anglePer = (2 * Math.PI) / total;
  const targetAngle = (total - selectedIndex) * anglePer + Math.random()*anglePer;

  // 转盘旋转动画
  const totalTurns = 4 * Math.PI + targetAngle; // 转4圈+目标位置
  const duration = 4000; // 4秒
  const startTime = performance.now();

  function animate(now) {
    const elapsed = now - startTime;
    const progress = Math.min(elapsed/duration, 1);
    currentRotation = progress * totalTurns;
    drawWheel();

    if (progress < 1) {
      requestAnimationFrame(animate);
    } else {
      alert('抽中的是：' + disks[selectedIndex].option);
      isSpinning = false;
    }
  }

  requestAnimationFrame(animate);
}

document.getElementById('spinBtn').onclick = spin;

// 初始绘制（等待加载完配置）
</script>
</body>
</html>
